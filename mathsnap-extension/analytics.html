<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics - MathSnap AI</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f9fafb; min-height: 100vh; padding: 40px 20px; }
    .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 16px; padding: 40px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .header { text-align: center; margin-bottom: 32px; }
    .logo-icon { width:64px; height:64px; background: linear-gradient(135deg,#3b82f6 0%,#9333ea 100%); border-radius:16px; display:inline-flex; align-items:center; justify-content:center; font-size:32px; margin-bottom:16px; }
    h1 { font-size:24px; color:#1f2937; margin-bottom:8px; }
    .subtitle { color:#6b7280; font-size:14px; }
    .form-group { margin-bottom:24px; }
    label { display:block; font-weight:600; color:#374151; margin-bottom:8px; font-size:14px; }
    input[type="text"], input[type="password"], input[type="url"] { width:100%; padding:12px; border:2px solid #e5e7eb; border-radius:8px; font-size:14px; font-family:inherit; transition: border-color 0.2s; }
    input:focus { outline:none; border-color:#3b82f6; }
    .help-text { font-size:12px; color:#6b7280; margin-top:6px; }
    .help-text a { color: #3b82f6; text-decoration: none; }
    .help-text a:hover { text-decoration: underline; }
    .checkbox-group { display:flex; align-items:center; gap:12px; padding:16px; background:#f9fafb; border-radius:8px; margin-bottom:24px; }
    .checkbox-group input[type="checkbox"] { width:20px; height:20px; cursor:pointer; }
    .checkbox-group label { margin:0; cursor:pointer; flex:1; }
    .button-group { display:flex; gap:12px; margin-bottom:16px; }
    button { flex:1; padding:12px 16px; border:none; border-radius:8px; font-weight:600; font-size:14px; cursor:pointer; transition: all 0.2s; font-family:inherit; }
    .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #9333ea 100%); color:white; }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
    .btn-secondary { background:#e5e7eb; color:#374151; }
    .btn-secondary:hover { background:#d1d5db; }
    .btn-danger { background:#ef4444; color:white; }
    .btn-danger:hover { background:#dc2626; }
    .status-message { padding:12px; border-radius:8px; font-size:14px; margin-top:16px; display:none; }
    .status-message.success { background:#d1fae5; color:#065f46; border:1px solid #86efac; display:block; }
    .status-message.error { background:#fee2e2; color:#991b1b; border:1px solid #fca5a5; display:block; }
    .status-message.info { background:#dbeafe; color:#1e40af; border:1px solid #93c5fd; display:block; }
    .info-box { background:#eff6ff; border:1px solid #bfdbfe; border-radius:8px; padding:16px; margin-top:24px; font-size:13px; color:#1e40af; }
    .info-box strong { display:block; margin-bottom:8px; }
    .info-box ul { margin-left:20px; margin-top:8px; }
    .info-box li { margin:4px 0; }
    .stats-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:24px; }
    .stat-card { background:#f9fafb; border-radius:8px; padding:16px; text-align:center; }
    .stat-value { font-size:24px; font-weight:700; color:#1f2937; margin-bottom:4px; }
    .stat-label { font-size:12px; color:#6b7280; text-transform:uppercase; letter-spacing:0.5px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo-icon">ðŸ“Š</div>
      <h1>Analytics Setup</h1>
      <p class="subtitle">Track extension usage with PostHog</p>
    </div>

    <div id="status-message" class="status-message"></div>

    <div class="form-group">
      <label for="apiKey">PostHog Project API Key</label>
      <input type="password" id="apiKey" placeholder="phc_xxxxxxxxxxxxxxxxxxxxx">
      <div class="help-text">
        Get your key from <a href="https://app.posthog.com/project/settings" target="_blank" rel="noopener">PostHog Project Settings</a>
      </div>
    </div>

    <div class="form-group">
      <label for="host">PostHog Host (Optional)</label>
      <input type="url" id="host" placeholder="https://app.posthog.com">
      <div class="help-text">Leave default unless using self-hosted PostHog</div>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" id="enabled">
      <label for="enabled">
        <strong>Enable Analytics</strong><br>
        <span style="font-size:12px;color:#6b7280;">Track extension usage to improve features</span>
      </label>
    </div>

    <div class="button-group">
      <button id="saveBtn" class="btn-primary">Save Settings</button>
      <button id="testBtn" class="btn-secondary">Test Connection</button>
    </div>

    <div class="button-group">
      <button id="viewDashboardBtn" class="btn-secondary">Open PostHog Dashboard</button>
      <button id="clearBtn" class="btn-danger">Clear Data</button>
    </div>

    <div class="stats-grid" id="statsGrid" style="display:none;">
      <div class="stat-card">
        <div class="stat-value" id="eventCount">-</div>
        <div class="stat-label">Events Tracked</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="lastEvent">-</div>
        <div class="stat-label">Last Event</div>
      </div>
    </div>

    <div class="info-box">
      <strong>ðŸ“Š What Gets Tracked:</strong>
      <ul>
        <li>Problems solved (success/failure)</li>
        <li>API response time (latency)</li>
        <li>Feature usage (screenshot, upload, type)</li>
        <li>Premium upgrades</li>
        <li>Error rates</li>
      </ul>
      <strong style="margin-top:12px;">ðŸ”’ Privacy:</strong>
      <ul>
        <li>No personal information collected</li>
        <li>Math problems NOT sent to analytics</li>
        <li>Anonymous user IDs only</li>
      </ul>
    </div>
  </div>

  <!-- library that exposes window.analytics -->
  <script src="lib/analytics.js"></script>
  <!-- UI logic (moved out of inline to satisfy CSP) -->
  <script src="analytics/analytics-ui.js"></script>
</body>
</html>